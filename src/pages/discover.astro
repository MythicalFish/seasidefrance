---
import SearchPage from '@modules/SearchPage';
import properties from '@data/properties';
import Layout from '@modules/Layout/index.astro';
import SiteHeader from '@modules/SiteHeader/index.astro';
import { generateSearchResults } from '@utils/generateSearchResults';
import Box from '@components/Box/index.astro';
import PropertyCard from '@components/PropertyCard/index.astro';
import AreaPhotos from '@modules/AreaPhotos/index.astro';
import WhyVisit1 from '@data/_fixtures/why-visit-1.md';
import WhyVisit2 from '@data/_fixtures/why-visit-2.md';

// Generate search results at build time for all properties
const searchResults = generateSearchResults(properties);
---

<Layout>
  <SiteHeader page="discover" />
  <main class="container p-4 md:p-8 pt-8 md:pt-16">
    <Box cozy class="mb-8">
      <div class="prose mb-4">
        <h2 class="mb-4">Discover Charente-Maritime</h2>
        <WhyVisit1 />
      </div>
      <AreaPhotos layout="grid" />
      <button
        id="read-more-btn"
        class="text-blue-600 hover:text-blue-800 underline cursor-pointer bg-transparent border-none p-0 font-inherit"
      >
        Read more...
      </button>
      <div class="prose" id="why-visit-2" style="display: none;">
        <WhyVisit2 />
      </div>
    </Box>
    <section id="availability" class="pt-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Book your stay</h2>
      <SearchPage properties={properties} client:load initialResults={searchResults} />
    </section>
    <Box cozy>
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Other properties</h2>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        {properties.map((property) => <PropertyCard property={property} />)}
      </div>
    </Box>
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const readMoreBtn = document.getElementById('read-more-btn');
    const whyVisit2 = document.getElementById('why-visit-2');

    if (readMoreBtn && whyVisit2) {
      readMoreBtn.addEventListener('click', function () {
        whyVisit2.style.display = 'block';
        readMoreBtn.style.display = 'none';
      });
    }
  });
</script>

<!-- <a
        href="https://www.tripadvisor.com/Tourism-g2064961-Charente_Maritime_Nouvelle_Aquitaine-Vacations.html"
        class="bg-transparent text-white underline"
        target="_blank">Read more on TripAdvisor</a
      > -->
