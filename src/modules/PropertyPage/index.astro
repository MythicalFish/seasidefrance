---
import { marked } from 'marked';
import Button from '@components/Button';
import properties from '@data/properties';
import Layout from '@modules/Layout/index.astro';
import PropertyCard from '@components/PropertyCard/index.astro';
import SiteHeader from '@modules/SiteHeader/index.astro';
import PropertyGallery from './PropertyGallery/index.astro';
import Pills from '@components/Pills';
import List from '@components/List';
import Box from '@components/Box/index.astro';
import AreaInfo from '@components/AreaInfo/index.astro';
import Availability from '@modules/Availability';
import { generatePropertySearchResults } from '@utils/generateSearchResults';

const { property } = Astro.props;
const descriptionHtml = property.description ? marked.parse(property.description) : '';
const otherProperties = properties.filter((property) => property.slug !== property.slug);
const searchResults = generatePropertySearchResults(property);
---

<Layout>
  <SiteHeader />
  <main class="container">
    <div>
      <div class="flex flex-col lg:flex-row gap-8">
        <div class="flex-auto w-full lg:w-2/3">
          <Box cozy>
            <div class="prose mb-4">
              <h3>{property.name}</h3>
              <p>
                {property.intro}
              </p>
            </div>
            <PropertyGallery
              propertyId={property.id}
              mainImageUrl={property.lodgify?.imageUrl}
              imageInfo={property.roomInfo.images}
            />
            <Pills items={property.features} className="mt-4" />
            <div class="my-4 prose" set:html={descriptionHtml} />
          </Box>
        </div>
        <div class="flex-auto w-full lg:w-1/3">
          <Box>
            <List title="Highlights" items={property.highlights} />
          </Box>
          <Button variant="primary" fullWidth href="#availability">Book your stay</Button>
          <Box class="mt-4">
            <AreaInfo />
          </Box>
        </div>
      </div>
    </div>
    <Availability client:load properties={[property]} initialResults={[searchResults]} />
    <section class="mt-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Other properties</h2>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        {otherProperties.map((property) => <PropertyCard property={property} />)}
      </div>
    </section>
  </main>
</Layout>
